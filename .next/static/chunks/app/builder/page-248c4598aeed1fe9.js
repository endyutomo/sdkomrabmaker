(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[462],{2948:(e,a,t)=>{"use strict";t.d(a,{Y:()=>n});var s=t(2115),r=t(4219);function n(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],{supabase:n,user:i}=(0,r._)(),[l,o]=(0,s.useState)(null),[d,c]=(0,s.useState)(!0),[m,u]=(0,s.useState)(null);return(0,s.useEffect)(()=>{if(!i){o(null),c(!1);return}let t=async()=>{c(!0);try{let t=n.from(e).select("*").eq("user_id",i.id);a&&(t=a(t));let{data:s,error:r}=await t;if(r)throw r;o(s)}catch(a){console.error("Error fetching from ".concat(e,":"),a),u(a)}finally{c(!1)}};t();let s=n.channel("".concat(e,"_changes")).on("postgres_changes",{event:"*",schema:"public",table:e,filter:"user_id=eq.".concat(i.id)},()=>{t()}).subscribe();return()=>{s.unsubscribe()}},[i,e,...t]),{data:l,isLoading:d,error:m}}},3998:(e,a,t)=>{"use strict";t.d(a,{$:()=>d});var s=t(5155),r=t(2115),n=t(7129),i=t(3101),l=t(4269);let o=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,a)=>{let{className:t,variant:r,size:i,asChild:d=!1,...c}=e,m=d?n.DX:"button";return(0,s.jsx)(m,{className:(0,l.cn)(o({variant:r,size:i,className:t})),ref:a,...c})});d.displayName="Button"},4219:(e,a,t)=>{"use strict";t.d(a,{SupabaseProvider:()=>m,_:()=>u});var s=t(5155),r=t(2115),n=t(5497),i=t(7358);let l=(i.env.NEXT_PUBLIC_SUPABASE_URL||"https://osizusigsteogyivmgfa.supabase.co").trim().replace(/["']/g,""),o=(i.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9zaXp1c2lnc3Rlb2d5aXZtZ2ZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5NzkwMjIsImV4cCI6MjA4NjU1NTAyMn0.hOgsqHUmqnlLM8g4eUAkbw00X-XIiMdXZslvZ7vNrEc").trim().replace(/["']/g,"");l&&l.startsWith("http")||console.warn("Invalid Supabase URL detected:",l);let d=(0,n.UU)(l,o),c=(0,r.createContext)(void 0);function m(e){let{children:a}=e,[t,n]=(0,r.useState)(null),[i,l]=(0,r.useState)(null),[o,m]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{d.auth.getSession().then(e=>{var a;let{data:{session:t}}=e;n(t),l(null!=(a=null==t?void 0:t.user)?a:null),m(!1)});let{data:{subscription:e}}=d.auth.onAuthStateChange((e,a)=>{var t;n(a),l(null!=(t=null==a?void 0:a.user)?t:null),m(!1)});return()=>{e.unsubscribe()}},[]),(0,s.jsx)(c.Provider,{value:{supabase:d,session:t,user:i,isLoading:o},children:a})}let u=()=>{let e=(0,r.useContext)(c);if(void 0===e)throw Error("useSupabase must be used within a SupabaseProvider");return e}},4269:(e,a,t)=>{"use strict";t.d(a,{cn:()=>n});var s=t(2821),r=t(5889);function n(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,r.QP)((0,s.$)(a))}},4839:(e,a,t)=>{"use strict";t.d(a,{BuilderClient:()=>e_});var s=t(5155),r=t(2115),n=t(63),i=t(4269);let l=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:a,className:(0,i.cn)("w-full caption-bottom text-sm",t),...r})})});l.displayName="Table";let o=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("thead",{ref:a,className:(0,i.cn)("[&_tr]:border-b",t),...r})});o.displayName="TableHeader";let d=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("tbody",{ref:a,className:(0,i.cn)("[&_tr:last-child]:border-0",t),...r})});d.displayName="TableBody",r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("tfoot",{ref:a,className:(0,i.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...r})}).displayName="TableFooter";let c=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("tr",{ref:a,className:(0,i.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...r})});c.displayName="TableRow";let m=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("th",{ref:a,className:(0,i.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...r})});m.displayName="TableHead";let u=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("td",{ref:a,className:(0,i.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...r})});u.displayName="TableCell",r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("caption",{ref:a,className:(0,i.cn)("mt-4 text-sm text-muted-foreground",t),...r})}).displayName="TableCaption";let p=r.forwardRef((e,a)=>{let{className:t,type:r,...n}=e;return(0,s.jsx)("input",{type:r,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...n})});p.displayName="Input";var h=t(3998),x=t(7646),f=t(639),g=t(5225),b=t(4381),j=t(8127),N=t(7314),y=t(3630),v=t(1719),w=t(4056),k=t(9915),A=t(109),S=t(3830),C=t(2033),P=t(9338),I=t(2925),_=t(2265),T=t(9007),R=t(1181),D=t(2634),B=t(4825),E=t(82),O=t(2251);let L=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(E.bL,{ref:a,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...r,children:(0,s.jsx)(E.C1,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,s.jsx)(O.A,{className:"h-4 w-4"})})})});L.displayName=E.bL.displayName;var M=t(489),J=t(3101);let U=(0,J.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),z=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(M.b,{ref:a,className:(0,i.cn)(U(),t),...r})});z.displayName=M.b.displayName;let F=(0,J.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function q(e){let{className:a,variant:t,...r}=e;return(0,s.jsx)("div",{className:(0,i.cn)(F({variant:t}),a),...r})}var K=t(5709),$=t(3263),G=t(5797);let H=K.bL,V=K.l9;K.YJ,K.ZL,K.Pb,K.z6,r.forwardRef((e,a)=>{let{className:t,inset:r,children:n,...l}=e;return(0,s.jsxs)(K.ZP,{ref:a,className:(0,i.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",t),...l,children:[n,(0,s.jsx)($.A,{className:"ml-auto"})]})}).displayName=K.ZP.displayName,r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(K.G5,{ref:a,className:(0,i.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}).displayName=K.G5.displayName;let Z=r.forwardRef((e,a)=>{let{className:t,sideOffset:r=4,...n}=e;return(0,s.jsx)(K.ZL,{children:(0,s.jsx)(K.UC,{ref:a,sideOffset:r,className:(0,i.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})})});Z.displayName=K.UC.displayName;let X=r.forwardRef((e,a)=>{let{className:t,inset:r,...n}=e;return(0,s.jsx)(K.q7,{ref:a,className:(0,i.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",t),...n})});X.displayName=K.q7.displayName,r.forwardRef((e,a)=>{let{className:t,children:r,checked:n,...l}=e;return(0,s.jsxs)(K.H_,{ref:a,className:(0,i.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:n,...l,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(K.VF,{children:(0,s.jsx)(O.A,{className:"h-4 w-4"})})}),r]})}).displayName=K.H_.displayName,r.forwardRef((e,a)=>{let{className:t,children:r,...n}=e;return(0,s.jsxs)(K.hN,{ref:a,className:(0,i.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(K.VF,{children:(0,s.jsx)(G.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=K.hN.displayName,r.forwardRef((e,a)=>{let{className:t,inset:r,...n}=e;return(0,s.jsx)(K.JU,{ref:a,className:(0,i.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",t),...n})}).displayName=K.JU.displayName,r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(K.wv,{ref:a,className:(0,i.cn)("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=K.wv.displayName;var Y=t(561);let W=Y.bL,Q=Y.l9,ee=r.forwardRef((e,a)=>{let{className:t,align:r="center",sideOffset:n=4,...l}=e;return(0,s.jsx)(Y.ZL,{children:(0,s.jsx)(Y.UC,{ref:a,align:r,sideOffset:n,className:(0,i.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...l})})});ee.displayName=Y.UC.displayName;var ea=t(5894),et=t(4219),es=t(2948);function er(e){let{project:a,onUpdateProjectInfo:t,onUpdateCategory:n,onUpdateItem:i,onDeleteItem:E,onAddItem:O,onDeleteCategory:M}=e,[J,U]=(0,r.useState)(!0),[F,K]=(0,r.useState)(!0),[$,G]=(0,r.useState)(5),[Y,er]=(0,r.useState)(null),{toast:en}=(0,ea.dj)(),{supabase:ei,user:el}=(0,et._)(),{data:eo}=(0,es.Y)("historical_boq_items",e=>e.order("last_used",{ascending:!1})),ed=a.categories,ec=async e=>{if(!(!ei||!el||!e.name||e.name.includes("Baru"))&&!(e.unitPrice<=0))try{let a=e.name.toLowerCase().trim().replace(/\s+/g,"-"),{error:t}=await ei.from("historical_boq_items").upsert({id:a,user_id:el.id,name:e.name,unit:e.unit,unit_price:e.unitPrice,type:e.type,vendor_name:e.vendorName||"",last_used:new Date().toISOString()});if(t)throw t}catch(e){console.error("Gagal menyimpan ke katalog:",e)}},em=e=>e.quantity*(e=>{let a=e.margin||0;return e.unitPrice*(1+a/100)})(e),eu=ed.reduce((e,a)=>e+a.items.filter(e=>"perangkat"===e.type).reduce((e,a)=>e+em(a),0),0),ep=ed.reduce((e,a)=>e+a.items.filter(e=>"jasa"===e.type).reduce((e,a)=>e+em(a),0),0),eh=ed.reduce((e,a)=>e+a.items.reduce((e,a)=>e+a.quantity*a.unitPrice,0),0),ex=eu+ep,ef=ex*$/100,eg=ex+ef,eb=J?11*eg/100:0,ej=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),eN=async(e,a)=>{if(!a.name||a.name.includes("Baru"))return void en({variant:"destructive",title:"Nama item tidak spesifik",description:"Masukkan nama item yang jelas sebelum meminta saran harga tertinggi."});er(a.id);try{if(!window.puter)throw Error("Layanan Puter.js tidak tersedia. Coba refresh halaman.");let t=new Date().toLocaleDateString("id-ID",{month:"long",year:"numeric"}),s='\n        Saya adalah estimator proyek konstruksi di Indonesia. Berikan estimasi harga satuan tertinggi (high-end) untuk item berikut dalam Rupiah (IDR).\n        \n        Item: "'.concat(a.name,'"\n        Tipe: ').concat(a.type," (perangkat/jasa)\n        Konteks Waktu: ").concat(t,"\n        \n        Instruksi:\n        1. Jika perangkat, cari harga dari Official Store atau penjual bereputasi tinggi di marketplace Indonesia (Tokopedia/Shopee/Bhinneka). PRIORITASKAN penjual di JABODETABEK (Jakarta, Bogor, Depok, Tangerang, Bekasi).\n        2. Jika jasa, estimasi biaya profesional di area Jabodetabek.\n        3. PENTING: Harga harus relevan dengan kondisi pasar bulan ").concat(t,'.\n        4. Output WAJIB dalam format JSON murni tanpa markdown block.\n        \n        Format JSON:\n        {\n          "suggestedPrice": number (harga dalam angka, contoh: 1500000),\n          "sourceName": string (contoh: "Tokopedia - Toko Abadi Jakarta"),\n          "sourceUrl": string (URL contoh atau link pencarian yang relevan),\n          "notes": string (alasan harga dan referensi waktu)\n        }\n      '),r=(await window.puter.ai.chat(s,{model:"gpt-4o-mini"})).message.content.trim().replace(/```json/g,"").replace(/```/g,""),n=JSON.parse(r);i(e,a.id,{unitPrice:n.suggestedPrice,sourceUrl:n.sourceUrl,vendorName:n.sourceName}),en({title:"Saran Harga Tertinggi Berhasil",description:"Menggunakan harga aman (high-end) dari ".concat(n.sourceName,".")}),ec({...a,unitPrice:n.suggestedPrice,vendorName:n.sourceName})}catch(a){console.error("Gagal mendapatkan saran harga:",a);let e="Terjadi kesalahan saat menghubungi AI.";"string"==typeof a?e=a:a instanceof Error?e=a.message:"object"==typeof a&&(e=JSON.stringify(a)),en({variant:"destructive",title:"Gagal",description:e})}finally{er(null)}};return(0,s.jsxs)("div",{className:"space-y-10 animate-fade-in-up",children:[(0,s.jsx)("div",{className:"bg-white rounded-2xl shadow-sm border p-8 space-y-6",children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start gap-6 border-b pb-8",children:[(0,s.jsxs)("div",{className:"space-y-4 flex-1 w-full",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-primary",children:[(0,s.jsx)(x.A,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Informasi Klien"})]}),(0,s.jsx)(p,{className:"text-3xl font-bold bg-transparent border-none focus:ring-0 p-0 h-auto placeholder:text-muted-foreground/30",placeholder:"Nama Klien / Perusahaan",value:a.clientName,onChange:e=>t({clientName:e.target.value})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground bg-slate-50 p-2 rounded-lg border border-slate-100",children:[(0,s.jsx)(f.A,{className:"h-4 w-4 shrink-0"}),(0,s.jsx)(p,{className:"bg-transparent border-none focus:ring-0 p-0 h-auto text-sm",placeholder:"Lokasi Proyek",value:a.projectLocation,onChange:e=>t({projectLocation:e.target.value})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground bg-slate-50 p-2 rounded-lg border border-slate-100",children:[(0,s.jsx)(g.A,{className:"h-4 w-4 shrink-0"}),(0,s.jsx)(p,{className:"bg-transparent border-none focus:ring-0 p-0 h-auto text-sm font-medium",placeholder:"Nama Proyek",value:a.title,onChange:e=>t({title:e.target.value})})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4 w-full md:w-72",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-primary",children:[(0,s.jsx)(b.A,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Data Dokumen"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(z,{className:"text-[10px] text-muted-foreground uppercase font-bold",children:"Nomor Dokumen"}),(0,s.jsx)(p,{className:"text-sm border-slate-200 focus:border-primary transition-colors h-11",placeholder:"RAB/2024/001",value:a.documentNumber,onChange:e=>t({documentNumber:e.target.value})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(z,{className:"text-[10px] text-muted-foreground uppercase font-bold",children:"Tanggal"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-slate-50 border rounded-md px-3 h-11 border-slate-200",children:[(0,s.jsx)(j.A,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsx)("input",{type:"date",className:"bg-transparent border-none focus:ring-0 text-sm flex-1 outline-none",value:a.documentDate,onChange:e=>t({documentDate:e.target.value})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(z,{className:"text-[10px] text-muted-foreground uppercase font-bold",children:"Pembuat RAB"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-white border rounded-md px-3 h-11 border-slate-200 focus-within:border-primary transition-colors",children:[(0,s.jsx)(N.A,{className:"h-4 w-4 text-primary"}),(0,s.jsx)(p,{className:"bg-transparent border-none focus:ring-0 p-0 h-auto text-sm font-semibold",placeholder:"Nama Penyusun",value:a.creatorName||"",onChange:e=>t({creatorName:e.target.value})})]})]})]})]})}),ed.map(e=>(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden",children:[(0,s.jsxs)("div",{className:"bg-slate-50 p-6 flex flex-col sm:flex-row items-center justify-between border-b gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 flex-1 w-full",children:[(0,s.jsx)("div",{className:"h-10 w-10 bg-primary/10 text-primary rounded-xl flex items-center justify-center font-bold",children:ed.indexOf(e)+1}),(0,s.jsx)(p,{className:"font-bold text-2xl bg-transparent border-transparent hover:border-slate-200 focus:border-primary h-12 w-full max-w-xl transition-all",value:e.name,onChange:a=>n(e.id,{name:a.target.value})}),(0,s.jsxs)(q,{variant:"outline",className:"hidden lg:inline-flex bg-white px-4 py-2 text-base font-bold shadow-sm text-primary whitespace-nowrap",children:["Sub-total: ",ej(e.items.reduce((e,a)=>e+em(a),0))]})]}),(0,s.jsx)(h.$,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive hover:bg-destructive/10 shrink-0",onClick:()=>M(e.id),children:(0,s.jsx)(y.A,{className:"h-5 w-5"})})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)(l,{className:"table-auto w-full min-w-[1500px]",children:[(0,s.jsx)(o,{children:(0,s.jsxs)(c,{className:"bg-slate-50/50 hover:bg-slate-50/50",children:[(0,s.jsx)(m,{className:"w-[60px] text-center",children:"Tipe"}),(0,s.jsx)(m,{className:"min-w-[600px]",children:"Uraian Pekerjaan & Spesifikasi"}),(0,s.jsx)(m,{className:"w-[120px]",children:"Satuan"}),(0,s.jsx)(m,{className:"min-w-[160px] text-right",children:"Vol (Qty)"}),(0,s.jsx)(m,{className:"min-w-[400px] text-right",children:"Harga Dasar (Modal)"}),(0,s.jsx)(m,{className:"min-w-[150px] text-right",children:"Margin (%)"}),(0,s.jsx)(m,{className:"min-w-[300px] text-right font-bold text-primary",children:"Total Jual (Rp)"}),(0,s.jsx)(m,{className:"min-w-[250px]",children:"Referensi Vendor"}),(0,s.jsx)(m,{className:"w-[100px] text-center",children:"AI"}),(0,s.jsx)(m,{className:"w-[50px]"})]})}),(0,s.jsx)(d,{children:e.items.map(a=>(0,s.jsxs)(c,{className:"group transition-colors hover:bg-slate-50/80",children:[(0,s.jsx)(u,{className:"text-center",children:"perangkat"===a.type?(0,s.jsx)(v.A,{className:"h-5 w-5 text-primary opacity-60 mx-auto"}):(0,s.jsx)(w.A,{className:"h-5 w-5 text-accent opacity-60 mx-auto"})}),(0,s.jsx)(u,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(p,{className:"bg-transparent border-none hover:bg-white hover:border-slate-200 focus:bg-white focus:border-primary h-11 font-medium text-slate-900 transition-all px-3 -ml-2 text-base w-full",value:a.name,placeholder:"Ketik nama item...",onChange:t=>i(e.id,a.id,{name:t.target.value}),onBlur:()=>setTimeout(()=>ec(a),500)}),eo&&eo.filter(e=>e.name.toLowerCase().includes(a.name.toLowerCase())&&a.name.length>2).length>0&&(0,s.jsxs)(W,{children:[(0,s.jsx)(Q,{asChild:!0,children:(0,s.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-primary shrink-0",children:(0,s.jsx)(k.A,{className:"h-4 w-4"})})}),(0,s.jsxs)(ee,{className:"w-80 p-0",align:"start",children:[(0,s.jsxs)("div",{className:"p-2 border-b bg-slate-50 flex items-center gap-2",children:[(0,s.jsx)(A.A,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsx)("span",{className:"text-xs font-bold text-muted-foreground uppercase tracking-wider",children:"Item dari Katalog"})]}),(0,s.jsx)("div",{className:"max-h-60 overflow-y-auto",children:eo.filter(e=>e.name.toLowerCase().includes(a.name.toLowerCase())).map((t,r)=>(0,s.jsxs)("button",{className:"w-full text-left p-3 hover:bg-slate-100 flex flex-col gap-1 border-b last:border-0 transition-colors",onClick:()=>{var s;return s=e.id,void(i(s,a.id,{name:t.name,unit:t.unit,unitPrice:t.unit_price,type:t.type,vendorName:t.vendor_name}),en({title:"Item Dimuat dari Katalog",description:"".concat(t.name," berhasil diterapkan.")}))},children:[(0,s.jsx)("span",{className:"font-bold text-sm text-primary",children:t.name}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-[10px] text-muted-foreground",children:[(0,s.jsxs)("span",{children:[ej(t.unit_price)," / ",t.unit]}),(0,s.jsx)("span",{className:"bg-slate-200 px-1.5 py-0.5 rounded uppercase",children:t.type})]})]},r))})]})]})]})}),(0,s.jsx)(u,{children:(0,s.jsx)(p,{className:"bg-transparent border-none hover:bg-white hover:border-slate-200 focus:bg-white focus:border-primary h-11 text-slate-600 px-3 -ml-2 w-full text-base",value:a.unit,onChange:t=>i(e.id,a.id,{unit:t.target.value})})}),(0,s.jsx)(u,{children:(0,s.jsx)(p,{type:"number",className:"bg-transparent border-none hover:bg-white hover:border-slate-200 focus:bg-white focus:border-primary h-11 text-right font-bold px-3 -ml-2 w-full text-lg",value:a.quantity,onChange:t=>i(e.id,a.id,{quantity:parseFloat(t.target.value)||0})})}),(0,s.jsx)(u,{children:(0,s.jsx)(p,{type:"number",className:"bg-transparent border-none hover:bg-white hover:border-slate-200 focus:bg-white focus:border-primary h-11 text-right font-black text-slate-900 px-3 -ml-2 w-full text-lg",value:a.unitPrice,onChange:t=>i(e.id,a.id,{unitPrice:parseFloat(t.target.value)||0}),onBlur:()=>ec(a)})}),(0,s.jsx)(u,{children:(0,s.jsx)(p,{type:"number",className:"bg-transparent border-none hover:bg-white hover:border-slate-200 focus:bg-white focus:border-primary h-11 text-right font-bold text-accent px-3 -ml-2 w-full text-lg",value:a.margin||0,onChange:t=>i(e.id,a.id,{margin:parseFloat(t.target.value)||0})})}),(0,s.jsx)(u,{className:"text-right font-black text-primary text-xl whitespace-nowrap px-4 bg-primary/5",children:ej(em(a))}),(0,s.jsx)(u,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(S.A,{className:"h-4 w-4 text-muted-foreground shrink-0"}),(0,s.jsx)(p,{className:"bg-transparent border-none hover:bg-white hover:border-slate-200 focus:bg-white focus:border-primary h-11 text-sm sm:text-sm text-slate-700 px-3 -ml-1 w-full font-medium",value:a.vendorName||"",placeholder:"Nama Toko / Vendor...",onChange:t=>i(e.id,a.id,{vendorName:t.target.value}),onBlur:()=>ec(a)})]})}),(0,s.jsx)(u,{className:"text-center",children:(0,s.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,s.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-10 w-10 text-accent hover:text-accent hover:bg-accent/10",onClick:()=>eN(e.id,a),disabled:Y===a.id,children:Y===a.id?(0,s.jsx)(C.A,{className:"h-5 w-5 animate-spin"}):(0,s.jsx)(P.A,{className:"h-5 w-5"})}),a.sourceUrl&&(0,s.jsx)("a",{href:a.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"text-muted-foreground hover:text-primary",children:(0,s.jsx)(I.A,{className:"h-4 w-4"})})]})}),(0,s.jsx)(u,{children:(0,s.jsx)(h.$,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 text-destructive h-10 w-10",onClick:()=>E(e.id,a.id),children:(0,s.jsx)(y.A,{className:"h-5 w-5"})})})]},a.id))})]})}),(0,s.jsx)("div",{className:"p-6 border-t bg-slate-50/30",children:(0,s.jsxs)(H,{children:[(0,s.jsx)(V,{asChild:!0,children:(0,s.jsxs)(h.$,{variant:"outline",size:"lg",className:"w-full h-12 text-primary border-primary/20 font-bold bg-white text-base",children:[(0,s.jsx)(_.A,{className:"h-5 w-5 mr-2"})," Tambah Item Pekerjaan ",(0,s.jsx)(T.A,{className:"h-4 w-4 ml-2 opacity-50"})]})}),(0,s.jsxs)(Z,{align:"center",className:"w-80 p-3",children:[(0,s.jsxs)(X,{className:"cursor-pointer py-3",onClick:()=>O(e.id,"perangkat"),children:[(0,s.jsx)(v.A,{className:"mr-4 h-6 w-6 text-primary"}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-bold",children:"Baris Perangkat"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Material, Hardware, Barang Fisik"})]})]}),(0,s.jsxs)(X,{className:"cursor-pointer py-3",onClick:()=>O(e.id,"jasa"),children:[(0,s.jsx)(w.A,{className:"mr-4 h-6 w-6 text-accent"}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-bold",children:"Baris Jasa"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Instalasi, Konfigurasi, Tenaga Kerja"})]})]})]})]})})]},e.id)),(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl border p-10 space-y-8",children:[(0,s.jsxs)("h3",{className:"text-2xl font-bold text-primary flex items-center gap-3",children:[(0,s.jsx)(R.A,{className:"h-7 w-7"})," Rekapitulasi Anggaran (Saran Harga Tertinggi)"]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-16",children:[(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-slate-100",children:[(0,s.jsxs)("span",{className:"text-slate-600 flex items-center gap-3 font-medium",children:[(0,s.jsx)(v.A,{className:"h-5 w-5 text-primary opacity-70"})," Total Perangkat"]}),(0,s.jsx)("span",{className:"font-bold text-slate-900",children:ej(eu)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-slate-100",children:[(0,s.jsxs)("span",{className:"text-slate-600 flex items-center gap-3 font-medium",children:[(0,s.jsx)(w.A,{className:"h-5 w-5 text-accent opacity-70"})," Total Jasa Instalasi"]}),(0,s.jsx)("span",{className:"font-bold text-slate-900",children:ej(ep)})]}),(0,s.jsx)("div",{className:"p-4 bg-emerald-50 rounded-xl space-y-2 border border-emerald-100",children:(0,s.jsxs)("div",{className:"flex items-center justify-between text-emerald-700 font-bold",children:[(0,s.jsx)("span",{children:"Estimasi Laba Kotor"}),(0,s.jsx)("span",{children:ej(ex-eh)})]})}),(0,s.jsx)("div",{className:"p-4 bg-slate-50 rounded-xl space-y-4 border border-slate-100",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(L,{id:"include-pph23",checked:F,onCheckedChange:e=>K(!!e)}),(0,s.jsx)(z,{htmlFor:"include-pph23",className:"text-slate-700 font-bold",children:"PPh 23 (Potongan Jasa 2%)"})]}),(0,s.jsxs)("span",{className:"font-bold text-destructive",children:["-",ej(F?2*ep/100:0)]})]})}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-slate-100",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"text-slate-600 font-medium",children:"Cadangan Tak Terduga (Contingency)"}),(0,s.jsxs)("div",{className:"flex items-center gap-1 bg-slate-100 px-3 py-1 rounded-full border",children:[(0,s.jsx)(p,{type:"number",className:"w-12 h-6 p-1 text-sm border-none bg-transparent font-bold text-center",value:$,onChange:e=>G(parseFloat(e.target.value)||0)}),(0,s.jsx)(D.A,{className:"h-3 w-3 text-slate-500"})]})]}),(0,s.jsx)("span",{className:"font-bold text-amber-600",children:ej(ef)})]}),(0,s.jsxs)("div",{className:"p-4 bg-primary/5 rounded-xl space-y-4 border border-primary/10",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(L,{id:"include-vat",checked:J,onCheckedChange:e=>U(!!e)}),(0,s.jsx)(z,{htmlFor:"include-vat",className:"text-slate-700 font-bold",children:"Sertakan PPN 11%"})]}),J&&(0,s.jsxs)("div",{className:"flex items-center justify-between pl-8",children:[(0,s.jsx)("span",{className:"text-slate-600 text-sm",children:"Nilai PPN 11%"}),(0,s.jsx)("span",{className:"font-bold text-slate-900",children:ej(eb)})]})]})]})}),(0,s.jsx)("div",{className:"flex flex-col justify-center gap-4",children:(0,s.jsxs)("div",{className:"boq-accent-gradient rounded-3xl p-10 text-white flex flex-col items-center justify-center text-center space-y-4 relative overflow-hidden shadow-2xl",children:[(0,s.jsx)("div",{className:"absolute top-0 right-0 p-6 opacity-10",children:(0,s.jsx)(B.A,{className:"h-32 w-32"})}),(0,s.jsx)("span",{className:"text-xs opacity-80 uppercase tracking-widest font-black",children:"Total Penawaran Aman"}),(0,s.jsx)("div",{className:"text-5xl font-black tracking-tight drop-shadow-lg",children:ej(eg+eb)})]})})]})]})]})}let en=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...r})});function ei(e){let{onSuggest:a}=e,[t,n]=(0,r.useState)(""),[i,l]=(0,r.useState)(""),[o,d]=(0,r.useState)(!1),c=async()=>{if(t){d(!0);try{if(!window.puter)throw Error("Layanan Puter.js tidak tersedia. Coba refresh halaman.");let e=new Date().toLocaleDateString("id-ID",{month:"long",year:"numeric"}),s='\n        Saya estimator konstruksi. Buatkan daftar Rencana Anggaran Biaya (RAB) untuk proyek: "'.concat(t,'".\n        Spesifikasi/Kondisi: "').concat(i||"Standar umum",'".\n        Konteks Waktu: ').concat(e,'\n        \n        Instruksi:\n        1. Kelompokkan item pekerjaan ke dalam kategori logis (misal: "Pekerjaan Persiapan", "Pekerjaan Pondasi", "Pekerjaan Lantai", dll).\n        2. Berikan estimasi volume dan harga satuan yang WAJAR dan TERUPDATE untuk wilayah Indonesia (Rupiah) per ').concat(e,'.\n        3. Tentukan tipe item: "perangkat" (material/barang) atau "jasa" (upah/instalasi).\n        4. Output WAJIB dalam format JSON murni array of objects.\n\n        Format JSON Output:\n        {\n          "categories": [\n            {\n              "name": "Nama Kategori",\n              "items": [\n                {\n                  "name": "Nama Item Pekerjaan",\n                  "unit": "Satuan (m2/m3/unit/ls)",\n                  "quantity": number,\n                  "unitPrice": number (harga satuan),\n                  "type": "perangkat" | "jasa"\n                }\n              ]\n            }\n          ]\n        }\n      '),r=(await window.puter.ai.chat(s,{model:"gpt-4o-mini"})).message.content.trim().replace(/```json/g,"").replace(/```/g,""),n=JSON.parse(r).categories.map((e,a)=>({id:"cat-".concat(Date.now(),"-").concat(a),name:e.name,items:e.items.map((e,t)=>({id:"item-".concat(Date.now(),"-").concat(a,"-").concat(t),name:e.name,unit:e.unit,quantity:e.quantity,unitPrice:e.unitPrice,type:e.type}))}));a(n)}catch(e){console.error("AI Generation failed:",e),alert("Gagal: ".concat(e.message||"Terjadi kesalahan pada AI"))}finally{d(!1)}}};return(0,s.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-primary/20 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-primary font-semibold",children:[(0,s.jsx)(P.A,{className:"h-5 w-5 text-accent"}),"Penyusun RAB Berbasis AI"]}),(0,s.jsxs)("div",{className:"grid gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(z,{htmlFor:"project-type",children:"Tipe Proyek"}),(0,s.jsx)(p,{id:"project-type",placeholder:"misal: Villa Mewah, Jalan Tol, Renovasi Kantor",value:t,onChange:e=>n(e.target.value)})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(z,{htmlFor:"specs",children:"Persyaratan Khusus (Opsional)"}),(0,s.jsx)(en,{id:"specs",placeholder:"Jelaskan spesifikasi seperti kondisi lahan, material yang diinginkan, atau jumlah lantai...",value:i,onChange:e=>l(e.target.value),className:"min-h-[100px]"})]})]}),(0,s.jsx)(h.$,{className:"w-full boq-accent-gradient hover:opacity-90 text-white font-medium",onClick:c,disabled:o||!t,children:o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Menghasilkan Item RAB..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(P.A,{className:"mr-2 h-4 w-4"}),"Hasilkan Saran"]})}),(0,s.jsx)("p",{className:"text-[10px] text-center text-muted-foreground uppercase tracking-wider",children:"Didukung oleh AI Generatif Canggih"})]})}en.displayName="Textarea";var el=t(1557),eo=t(272),ed=t(4908),ec=t(6802),em=t(6251),eu=t(1190),ep=t(6302),eh=t(5584),ex=t(3180),ef=t(2619),eg=t.n(ef),eb=t(9315),ej=t(7283),eN=t(6615);let ey=ej.bL,ev=ej.l9;ej.bm;let ew=ej.ZL,ek=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(ej.hJ,{className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r,ref:a})});ek.displayName=ej.hJ.displayName;let eA=(0,J.F)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),eS=r.forwardRef((e,a)=>{let{side:t="right",className:r,children:n,...l}=e;return(0,s.jsxs)(ew,{children:[(0,s.jsx)(ek,{}),(0,s.jsxs)(ej.UC,{ref:a,className:(0,i.cn)(eA({side:t}),r),...l,children:[n,(0,s.jsxs)(ej.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,s.jsx)(eN.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});eS.displayName=ej.UC.displayName;let eC=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...t})};eC.displayName="SheetHeader";let eP=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(ej.hE,{ref:a,className:(0,i.cn)("text-lg font-semibold text-foreground",t),...r})});eP.displayName=ej.hE.displayName,r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(ej.VY,{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",t),...r})}).displayName=ej.VY.displayName;var eI=t(2241);function e_(){let e=(0,n.useSearchParams)(),a=(0,n.useRouter)(),i=e.get("id"),[l,o]=(0,r.useState)({id:"proj-".concat(Date.now()),title:"Draft RAB Baru",type:"",specifications:"",categories:[],createdAt:new Date().toISOString(),clientName:"",documentNumber:"RAB/".concat(new Date().getFullYear(),"/001"),projectLocation:"",documentDate:new Date().toISOString().split("T")[0]}),[d,c]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),{toast:p}=(0,ea.dj)(),{supabase:x,user:f,isLoading:b}=(0,et._)();(0,r.useEffect)(()=>{b||f||x.auth.signInAnonymously().catch(e=>{console.error("Anonymous sign-in failed:",e),p({variant:"destructive",title:"Autentikasi Gagal",description:"Gagal masuk secara anonim. Pastikan 'Anonymous Sign-ins' sudah diaktifkan di menu Authentication > Providers pada dashboard Supabase Anda."})})},[f,b,x]),(0,r.useEffect)(()=>{let e=async()=>{if(x&&f&&i&&!m)try{let{data:e,error:t}=await x.from("projects").select("*").eq("id",i).eq("user_id",f.id).single();if(t)throw t;if(e){let a={id:e.id,title:e.title,type:e.type||"",specifications:e.specifications||"",categories:e.categories||[],clientName:e.client_name||"",creatorName:e.creator_name||"",documentNumber:e.document_number||"",projectLocation:e.project_location||"",documentDate:e.document_date||"",createdAt:e.created_at};o(a),u(!0)}else p({variant:"destructive",title:"Proyek Tidak Ditemukan",description:"Data proyek yang Anda cari tidak tersedia."}),a.push("/dashboard")}catch(e){console.error("Error loading project:",e)}};f&&x&&i&&e()},[x,f,i,m,a,p]);let j=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Bagian Baru",a={id:"cat-".concat(Date.now()),name:e,items:[]};o(e=>({...e,categories:[...e.categories,a]}))},N=e=>{o(a=>({...a,categories:[...a.categories,...e]})),p({title:"Saran AI Diterapkan",description:"Berhasil menambahkan ".concat(e.length," kategori pekerjaan baru.")})},y=async()=>{let e=f;if(x){if(!e)try{let{data:a,error:t}=await x.auth.signInAnonymously();if(t)throw t;a.user&&(e=a.user)}catch(e){console.error("Auto-login failed:",e),p({variant:"destructive",title:"Gagal Masuk",description:"Gagal melakukan login otomatis. Pastikan fitur 'Anonymous Sign-ins' sudah diaktifkan di Supabase Dashboard (Authentication > Providers)."});return}if(!e)return void p({variant:"destructive",title:"Gagal Menyimpan",description:"Anda harus masuk untuk menyimpan proyek."});c(!0);try{let{error:t}=await x.from("projects").upsert({id:l.id,user_id:e.id,title:l.title,type:l.type,specifications:l.specifications,categories:l.categories,client_name:l.clientName,creator_name:l.creatorName,document_number:l.documentNumber,project_location:l.projectLocation,document_date:l.documentDate,created_at:l.createdAt,updated_at:new Date().toISOString()});if(t){console.error("Supabase Save Error:",t);let e="Terjadi kesalahan saat menyimpan ke database.";throw"42P01"===t.code?e="Tabel 'projects' belum dibuat di Supabase. Silakan jalankan script SQL di walkthrough.md.":t.message&&(e=t.message),Error(e)}p({title:"Proyek Berhasil Disimpan",description:'Proyek "'.concat(l.title,'" telah direkam di database SDKOM RAB MAker.')}),i||a.replace("/builder?id=".concat(l.id))}catch(e){console.error("Gagal menyimpan proyek:",e),p({variant:"destructive",title:"Gagal Menyimpan",description:e.message||"Terjadi kesalahan saat menyimpan ke database."})}finally{c(!1)}}},v=()=>{setTimeout(()=>{window.print()},500)};if(b||i&&!m)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)(C.A,{className:"h-10 w-10 animate-spin text-primary"}),(0,s.jsx)("p",{className:"text-slate-500 font-medium animate-pulse",children:"Memuat data SDKOM RAB MAker..."})]})});let w=()=>(0,s.jsxs)("div",{className:"space-y-8 h-full flex flex-col",children:[(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto pr-2",children:[(0,s.jsx)(ei,{onSuggest:N}),(0,s.jsxs)("div",{className:"space-y-4 mt-8",children:[(0,s.jsx)("h3",{className:"text-xs font-bold text-muted-foreground uppercase tracking-widest",children:"Tambah Cepat Kategori"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-2",children:[(0,s.jsxs)(h.$,{variant:"outline",className:"justify-start border-dashed hover:border-primary font-bold w-full",onClick:()=>j("Perangkat & Hardware"),children:[(0,s.jsx)(el.A,{className:"h-4 w-4 mr-2 text-primary"})," Perangkat Utama"]}),(0,s.jsxs)(h.$,{variant:"outline",className:"justify-start border-dashed hover:border-primary font-bold w-full",onClick:()=>j("Jasa Instalasi & Konfigurasi"),children:[(0,s.jsx)(eo.A,{className:"h-4 w-4 mr-2 text-accent"})," Jasa Instalasi"]}),(0,s.jsxs)(h.$,{variant:"outline",className:"justify-start border-dashed hover:border-primary font-bold w-full",onClick:()=>j("Mobilisasi & Alat Kerja"),children:[(0,s.jsx)(ed.A,{className:"h-4 w-4 mr-2 text-amber-500"})," Mobilisasi"]}),(0,s.jsxs)(h.$,{variant:"outline",className:"justify-start font-bold w-full",onClick:()=>j(),children:[(0,s.jsx)(_.A,{className:"h-4 w-4 mr-2"})," Bagian Kustom"]})]})]})]}),(0,s.jsxs)("div",{className:"pt-6 border-t space-y-2",children:[(0,s.jsx)(eg(),{href:"/dashboard",children:(0,s.jsxs)(h.$,{variant:"ghost",className:"w-full justify-start text-muted-foreground font-bold",children:[(0,s.jsx)(ec.A,{className:"h-4 w-4 mr-2"})," Proyek Saya"]})}),(0,s.jsxs)(h.$,{variant:"ghost",className:"w-full justify-start text-muted-foreground font-bold",onClick:v,children:[(0,s.jsx)(em.A,{className:"h-4 w-4 mr-2"})," Pratinjau Cetak"]})]})]});return(0,s.jsxs)("div",{className:"min-h-screen flex flex-col bg-background",children:[(0,s.jsxs)("header",{className:"h-16 border-b bg-white flex items-center justify-between px-4 lg:px-6 sticky top-0 z-30 shadow-sm no-print",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"lg:hidden",children:(0,s.jsxs)(ey,{children:[(0,s.jsx)(ev,{asChild:!0,children:(0,s.jsx)(h.$,{variant:"ghost",size:"icon",children:(0,s.jsx)(eI.A,{className:"h-6 w-6"})})}),(0,s.jsxs)(eS,{side:"left",className:"w-[85vw] sm:w-[350px]",children:[(0,s.jsx)(eC,{className:"mb-4",children:(0,s.jsxs)(eP,{className:"text-left flex items-center gap-2",children:[(0,s.jsx)(eb.Logo,{className:"h-6 w-6"}),"Menu RAB Maker"]})}),(0,s.jsx)(w,{})]})]})}),(0,s.jsx)(eg(),{href:"/dashboard",className:"hidden lg:block",children:(0,s.jsx)(h.$,{variant:"ghost",size:"icon",className:"text-muted-foreground",children:(0,s.jsx)(eu.A,{className:"h-5 w-5"})})}),(0,s.jsx)("div",{className:"h-8 w-px bg-border hidden lg:block"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 overflow-hidden",children:[(0,s.jsx)(eb.Logo,{className:"h-8 w-8 hidden sm:block"}),(0,s.jsx)("input",{className:"text-lg font-bold bg-transparent border-none focus:outline-none focus:ring-1 focus:ring-primary/20 px-2 rounded w-full lg:min-w-[300px] text-primary truncate",value:l.title,onChange:e=>o(a=>({...a,title:e.target.value}))})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(H,{children:[(0,s.jsx)(V,{asChild:!0,children:(0,s.jsxs)(h.$,{variant:"outline",size:"sm",className:"hidden sm:flex",children:[(0,s.jsx)(ep.A,{className:"h-4 w-4 mr-2"})," Ekspor"]})}),(0,s.jsx)(V,{asChild:!0,children:(0,s.jsx)(h.$,{variant:"outline",size:"icon",className:"sm:hidden",children:(0,s.jsx)(ep.A,{className:"h-4 w-4"})})}),(0,s.jsxs)(Z,{align:"end",className:"w-56",children:[(0,s.jsxs)(X,{onClick:v,className:"cursor-pointer",children:[(0,s.jsx)(g.A,{className:"h-4 w-4 mr-2 text-red-500"})," Simpan sebagai PDF"]}),(0,s.jsxs)(X,{onClick:()=>{try{Promise.all([t.e(524),t.e(436)]).then(t.bind(t,4246)).then(e=>{let a=e.utils.book_new(),t=[];t.push(["Rencana Anggaran Biaya (RAB)"]),t.push([""]),t.push(["Nama Proyek",l.title]),t.push(["Klien",l.clientName]),t.push(["Lokasi",l.projectLocation]),t.push(["Nomor Dokumen",l.documentNumber]),t.push(["Tanggal",l.documentDate]),t.push(["Penyusun",l.creatorName]),t.push([""]),t.push(["No","Kategori / Item","Spesifikasi","Volume","Satuan","Harga Satuan (Rp)","Total Harga (Rp)","Tipe","Vendor"]);let s=0;l.categories.forEach((e,a)=>{t.push([(a+1).toString(),e.name.toUpperCase(),"","","","","","",""]),e.items.forEach((e,r)=>{e.quantity,e.unitPrice;let n=e.margin||0,i=e.unitPrice*(1+n/100),l=e.quantity*i;s+=l,t.push(["".concat(a+1,".").concat(r+1),e.name,"",e.quantity,e.unit,i,l,e.type,e.vendorName])});let r=e.items.reduce((e,a)=>{let t=a.margin||0,s=a.unitPrice*(1+t/100);return e+a.quantity*s},0);t.push(["","Subtotal ".concat(e.name),"","","","",r,"",""]),t.push([""])}),t.push([""]),t.push(["","TOTAL RAB","","","","",s,"",""]);let r=e.utils.aoa_to_sheet(t);r["!cols"]=[{wch:5},{wch:40},{wch:20},{wch:10},{wch:10},{wch:15},{wch:15},{wch:10},{wch:20}],e.utils.book_append_sheet(a,r,"RAB");let n="RAB-".concat(l.clientName||"Draft","-").concat(new Date().toISOString().slice(0,10),".xlsx");e.writeFile(a,n),p({title:"Ekspor Berhasil",description:"File ".concat(n," telah diunduh.")})})}catch(e){console.error("Export failed:",e),p({variant:"destructive",title:"Gagal Ekspor",description:"Terjadi kesalahan saat membuat file Excel."})}},className:"cursor-pointer",children:[(0,s.jsx)(eh.A,{className:"h-4 w-4 mr-2 text-green-600"})," Ekspor ke Excel (.xlsx)"]})]})]}),(0,s.jsxs)(h.$,{className:"boq-accent-gradient h-9 text-white font-bold hidden sm:flex",onClick:y,disabled:d,children:[d?(0,s.jsx)(C.A,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(ex.A,{className:"h-4 w-4 mr-2"}),"Simpan"]}),(0,s.jsx)(h.$,{className:"boq-accent-gradient h-9 w-9 p-0 text-white font-bold sm:hidden",onClick:y,disabled:d,children:d?(0,s.jsx)(C.A,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(ex.A,{className:"h-4 w-4"})})]})]}),(0,s.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,s.jsx)("aside",{className:"w-80 border-r bg-white p-6 hidden lg:block no-print overflow-y-auto h-[calc(100vh-64px)]",children:(0,s.jsx)(w,{})}),(0,s.jsx)("main",{className:"flex-1 overflow-y-auto p-4 lg:p-12 bg-slate-50/50 print:p-0 print:bg-white w-full",children:(0,s.jsx)("div",{className:"max-w-6xl mx-auto",children:0===l.categories.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[60vh] text-center space-y-6 animate-fade-in-up no-print px-4",children:[(0,s.jsx)("div",{className:"w-16 h-16 lg:w-20 lg:h-20 bg-primary/5 rounded-2xl flex items-center justify-center text-primary rotate-3",children:(0,s.jsx)(eb.Logo,{className:"h-8 w-8 lg:h-10 lg:w-10 opacity-40"})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h2",{className:"text-xl lg:text-2xl font-bold text-primary",children:"Siap Menyusun RAB?"}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm lg:text-base max-w-sm",children:"Gunakan panel samping (atau menu di HP) untuk menambah kategori perangkat dan jasa secara cepat, atau biarkan AI SDKOM RAB MAker memberikan saran item yang relevan."})]}),(0,s.jsx)("div",{className:"flex gap-4",children:(0,s.jsxs)(h.$,{size:"lg",className:"boq-accent-gradient h-12 px-8 font-bold",onClick:()=>j("Perangkat Utama"),children:[(0,s.jsx)(_.A,{className:"h-5 w-5 mr-2"})," Mulai Input Manual"]})})]}):(0,s.jsx)(er,{project:l,onUpdateProjectInfo:e=>{o(a=>({...a,...e}))},onUpdateCategory:(e,a)=>{o(t=>({...t,categories:t.categories.map(t=>t.id===e?{...t,...a}:t)}))},onUpdateItem:(e,a,t)=>{o(s=>({...s,categories:s.categories.map(s=>s.id===e?{...s,items:s.items.map(e=>e.id===a?{...e,...t}:e)}:s)}))},onDeleteItem:(e,a)=>{o(t=>({...t,categories:t.categories.map(t=>t.id===e?{...t,items:t.items.filter(e=>e.id!==a)}:t)}))},onAddItem:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"perangkat",t={id:"item-".concat(Date.now()),name:"perangkat"===a?"Item Perangkat Baru":"Item Jasa Baru",unit:"perangkat"===a?"Unit":"Lot",quantity:1,unitPrice:0,type:a,margin:0};o(a=>({...a,categories:a.categories.map(a=>a.id===e?{...a,items:[...a.items,t]}:a)}))},onDeleteCategory:e=>{o(a=>({...a,categories:a.categories.filter(a=>a.id!==e)}))}})})})]})]})}},5245:(e,a,t)=>{Promise.resolve().then(t.bind(t,4839))},5894:(e,a,t)=>{"use strict";t.d(a,{dj:()=>m});var s=t(2115);let r=0,n=new Map,i=e=>{if(n.has(e))return;let a=setTimeout(()=>{n.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,a)},l=[],o={toasts:[]};function d(e){o=((e,a)=>{switch(a.type){case"ADD_TOAST":return{...e,toasts:[a.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===a.toast.id?{...e,...a.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=a;return t?i(t):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===a.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==a.toastId)}}})(o,e),l.forEach(e=>{e(o)})}function c(e){let{...a}=e,t=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>d({type:"DISMISS_TOAST",toastId:t});return d({type:"ADD_TOAST",toast:{...a,id:t,open:!0,onOpenChange:e=>{e||s()}}}),{id:t,dismiss:s,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function m(){let[e,a]=s.useState(o);return s.useEffect(()=>(l.push(a),()=>{let e=l.indexOf(a);e>-1&&l.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},9315:(e,a,t)=>{"use strict";t.d(a,{Logo:()=>r});var s=t(5155);function r(e){let{className:a="h-8 w-8"}=e;return(0,s.jsxs)("svg",{viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:a,children:[(0,s.jsx)("path",{d:"M20 50C20 33.4315 33.4315 20 50 20C66.5685 20 80 33.4315 80 50",stroke:"#2E3192",strokeWidth:"6",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M80 50C80 66.5685 66.5685 80 50 80C33.4315 80 20 66.5685 20 50",stroke:"#ED1C24",strokeWidth:"6",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M65 60C70.5228 60 75 55.5228 75 50C75 44.4772 70.5228 40 65 40C64.6544 40 64.3146 40.0175 63.9806 40.0514C61.9427 34.1951 56.4554 30 50 30C42.0673 30 35.419 36.4385 35.0189 44.2464C32.1856 45.4807 30 48.3396 30 51.6667C30 56.269 33.731 60 38.3333 60H65Z",fill:"#0071BC"}),(0,s.jsx)("rect",{x:"42",y:"42",width:"4",height:"12",rx:"1",fill:"white"}),(0,s.jsx)("rect",{x:"48",y:"42",width:"4",height:"12",rx:"1",fill:"white"}),(0,s.jsx)("rect",{x:"54",y:"42",width:"4",height:"12",rx:"1",fill:"white"})]})}t(2115)}},e=>{e.O(0,[206,619,461,646,441,255,358],()=>e(e.s=5245)),_N_E=e.O()}]);